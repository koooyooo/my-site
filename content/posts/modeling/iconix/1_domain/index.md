---
title: "ICONIX - 1.Domain分析"
date: 2020-12-06T01:30:34+09:00
draft: false
---
## ICONIXの分析工程
ここでは、ICONIXの分析工程を見てゆきます。最初に全てのベースとなる静的モデルのドメイン分析、続けて動的モデルのユースケース分析、ロバストネス分析、そしてシーケンス分析と進みます。この過程で、全ての主要な用語はドメイン分析で作成したドメイン用語集を元に行わなければなりません。

ドメイン用語集に「ユーザー」と定義したならば、以降の分析に出てくる用語は「利用者」ではなく「ユーザー」なのです。「利用者」の方が適切だと思ったのならば、まずドメイン用語集を直さなければなりません。では、最初にそのドメイン分析から入りたいと思います。

## ドメイン分析

ドメイン用語集は全ての工程の基本です。フワフワとした曖昧な言葉を棄て、正確で本質的な用語を捉えてゆくと、思考がクリアになります。また、ドメイン用語は属性も定義しますので、「ユーザー」と定義した際に「ユーザーID」や「氏名」「住所」等が含まれているのか否かも明確になります。

仮に「ユーザーID」や「氏名」「住所」等が含まれていた場合は、会話の中で「ユーザーを渡し…」といった場合にこれらの情報も付随することが分かるわけです。厳密さだけではなく簡潔さも手に入れる事ができます。会話と文書が徐々に変わってゆくのが体験できるかも知れません。

> Before: システムはユーザID, 氏名, 住所を画面に表示する。  
> After : システムはユーザー情報を画面に表示する。

---
### ドメインの抽出
ドメイン分析を行うには、最初に**ドメイン用語の候補を抽出**します。これはドメインエキスパートが提供するユーザーストーリー等から導き出します。何やら難しそうに聞こえますが、ドメインエキスパートというのは業務に詳しい担当者、ユーザーストーリーとは業務の流れを説明した文章です。簡単に説明すると「お話を聞いたり文章を読んだりしてキーワードを見つける」という作業に過ぎません。

ユーザーストーリーが無いのであれば、関連がありそうな文書を漁ってみましょう。それは簡単なシステム化の企画書かも知れませんし、何らかのマニュアルや、場合によっては誰かが残したメモかも知れません。

---

### 関連の洗い出し
一通りドメイン用語が洗い出せたなら、次に**用語同士の関連**を洗い出します。最初に**単純な線**で関連を引いてみましょう。ここで注意するのは、厳密に定義しすぎると多くの用語同士に線が引かれてゴチャついてくる事態です。原則としてドメイン分析はモデリング作業なので、全て正確に洗い出すというより「大事な部分を強調し細かい部分は無視する」というスタンスが重要です。余計な部分を削ぎ落としてこそ大事な部分が目立つからです。

![Class AB](/posts/modeling/iconix/1_domain/class-ab.png)

---

### 関連の分類
用語間に線を引き終えたら、次に線を三種類に分類しましょう。「関連」「汎化」「集約」の関係に大きく分類できれば良いと思います。

| # | 項目 | 説明 |
| --- | --- | --- |
| 1 | 関連 | 用語同士の一般的な関係です。"has a"とも表現され、一定期間相手の参照を持ちそれを使用します。<br>AはBを使う、AはBを生成する…等です。|
| 2 | 汎化 | 用語同士の継承関係です。"is a" とも表現され「課金ユーザー」は「ユーザ」の性質を継承する…等です |
| 3 | 集約 | 用語同士の保有関係です。"owns a" とも表現され「バイク」は「エンジン」を保有する…等です |

&nbsp;  
![Class AB](/posts/modeling/iconix/1_domain/domain-type.png)

---

### 分類の詳細化
一旦大きく分類が出来たら、次に関連を詳細化しましょう。

| # | 項目 | 説明 |
| --- | --- | --- |
| 1 | 関連 | 用語同士の関連に名前をつけ、関連が片方向のものであれば関連線を矢印(<---)に変更します |
| 2 | 汎化 | 汎化関係を「汎化」(<I---)と「実現」(<I...)に細かく分類します |
| 3 | 集約 | 集約関係を「集約」(◇---)と「コンポジション」(◆---)に細かく分類します |

&nbsp;  
例えば、AがBを暫く利用しているだけの関係で、BがAを利用することがなければ関連線に方向 (**誘導可能性**) を持たせます。関連線が矢印になっていない場合は暗黙的に双方向の関連を意味します(またはラフに関連を引いただけかも知れません)。矢印で線が破線の場合は、ごく一時的な利用関係を意味し**依存**と呼びます。関連としては特に弱いものです。

下の例では、ユーザの情報を守るため、ユーザには情報を暗号化する責務をもたせてあり、この責務を「情報保護」インターフェイスで表現しています。責務を表現する抽象的なインターフェイスと、それを履行しているクラスの関係を**実現**と言い、汎化で利用した白抜き矢印の線を破線にすることで表現します。

次にバイクとエンジンの関係ですが、ですが、厳密にはバイクがエンジンを保有(**owns a**)しているというよりは、もはやエンジンはバイクの一部であり、多くの場合バイクを破棄する時にはエンジンも破棄します(ライフサイクルの一致)。この(**is a part of**)の関係が成立する時はより強力な包含関係(**コンポジション**)に昇格させます。

---

### 多重度の定義
関連の詳細化が終わったら、汎化(実現) 以外の関連に数的な関係(多重度)を定義します。例えば「バイク」と「エンジン」の多重度は 1:1 です。最大300人が入れる映画館とお客さんの多重度は 1:0..300です。Webページと閲覧者の関係は、0..*:0..*です。どちらも0にも出来ますし、無限にもできるからです。

> 但し、バイクの生産中の過程も管理する様であれば、組立て前のバイクや、部品としてのエンジンもあるかも知れません。バイクから見てエンジンは0か1、エンジンから見たバイクも0か1、そうなると双方の関係は 0..1:0..1となりそうです。  
(0…1は 0以上1以下を表します)

---

### ドメインモデル (暫定版)
以上を図で表現すると、以下の様になります。最初は少し慣れないと思いますが、慣れてしまえば表現力の高い強力な図です。

> ここまで詳細化できるのであれば、プログラムにまで落とし込めそうな気がしますが、そこまで考慮すると細かな変数や操作が増えてノイズとなってしまいますので、一旦シンプルな概念図にとどめておくのが適切です。(あと一歩で本物のクラス図という状況なのでこの時点でプログラム化は比較的簡単です)

![Class AB](/posts/modeling/iconix/1_domain/domain-detail.png)

| # | 項目 | 説明 |
| --- | --- | --- |
| 1 | 目的 | 用語の定義と関連を明確にし、文書や会話で利用しつつ、プログラムに落としやすくする |
| 2 | 手法 | ユーザーストーリー・会話の中から主要な単語を拾い、関連を徐々に詳細化する |

&nbsp;  
ドメイン用語集に属性や操作の情報が殆ど載っていないことが気になるかも知れませんが、ロバストネス分析やユースケース分析の際に本格的に洗い出されるため、現時点ではそれほど心配する必要はありません。最初の分析はしばし考えすぎて過剰分析になる傾向があるため、数時間程度で切り上げるのが通例です。

### まとめ
今回は、分析工程の最初として、ユーザーストーリーからドメインモデルを洗い出しました。その後、モデル間の関連を確認し、可能であればそれらに詳細な情報を与えました。これは最初の分析としては充分ですし、ユースケース分析を確認しないままこれ以上の分析しても、過剰な詳細化に陥る恐れも高く危険だと判断し、次の分析に進むことにしました。

次回は、動的なモデルの生成について説明したいと思います。。。

<!--
### ユースケース分析
### ロバストネス分析
### シーケンス分析
-->
